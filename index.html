<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Timetable Slot Manager</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
    
    :root {
      --primary: #0af;
      --secondary: #0ff;
      --success: #0f8;
      --error: #f08;
      --bg-dark: #0a0a12;
      --bg-light: rgba(0, 20, 40, 0.8);
      --highlight: rgba(0, 255, 170, 0.3);
    }
    
    body {
      font-family: 'Share Tech Mono', monospace;
      margin: 0;
      padding: 15px;
      background-color: var(--bg-dark);
      color: var(--primary);
      line-height: 1.5;
      font-size: 15px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(0, 170, 255, 0.05) 0%, transparent 25%),
        radial-gradient(circle at 80% 70%, rgba(0, 255, 170, 0.05) 0%, transparent 25%);
    }
    
    h1, h2 {
      text-align: center;
      color: var(--secondary);
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
      margin: 20px 0 15px;
      letter-spacing: 1px;
    }
    
    h1 {
      font-size: 2em;
      position: relative;
      padding-bottom: 10px;
      animation: pulse 4s infinite alternate;
    }
    
    @keyframes pulse {
      0% { text-shadow: 0 0 10px rgba(0, 255, 255, 0.7); }
      100% { text-shadow: 0 0 15px rgba(0, 255, 255, 0.9), 0 0 25px rgba(0, 255, 255, 0.5); }
    }
    
    h1::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 25%;
      width: 50%;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--secondary), transparent);
      animation: scanline 3s linear infinite;
    }
    
    h2 {
      font-size: 1.5em;
      margin-top: 25px;
    }
    
    .control-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
      align-items: end;
      background: rgba(0, 10, 20, 0.7);
      padding: 20px;
      border-radius: 5px;
      border: 1px solid var(--primary);
      box-shadow: 0 0 20px rgba(0, 170, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .control-panel::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--secondary), transparent);
      animation: scanline 6s linear infinite;
    }
    
    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(calc(100vh + 100%)); }
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    .input-group label {
      font-size: 0.8em;
      color: var(--secondary);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }
    
    input, select, textarea {
      padding: 9px 12px;
      font-size: 1em;
      border: 1px solid var(--primary);
      background: var(--bg-light);
      color: var(--secondary);
      font-family: inherit;
      width: 100%;
      box-sizing: border-box;
      border-radius: 4px;
      transition: all 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
      transform: translateY(-1px);
    }
    
    input::placeholder, textarea::placeholder {
      color: var(--primary);
      opacity: 0.6;
    }
    
    button {
      padding: 9px 15px;
      font-size: 0.95em;
      border: 1px solid var(--primary);
      background: linear-gradient(to bottom, rgba(0, 100, 200, 0.5), rgba(0, 50, 100, 0.5));
      color: var(--secondary);
      font-family: inherit;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    button:hover {
      background: linear-gradient(to bottom, rgba(0, 150, 255, 0.6), rgba(0, 100, 200, 0.6));
      text-shadow: 0 0 8px var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 170, 255, 0.3);
    }
    
    button::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.1),
        transparent
      );
      transition: 0.5s;
      z-index: -1;
    }
    
    button:hover::before {
      left: 100%;
    }
    
    .status {
      text-align: center;
      margin: 12px 0 8px;
      padding: 10px;
      font-size: 0.95em;
      grid-column: 1 / -1;
      border-radius: 4px;
      letter-spacing: 1px;
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .status.success {
      color: var(--success);
      background: rgba(0, 255, 0, 0.15);
      border: 1px solid var(--success);
    }
    
    .status.error {
      color: var(--error);
      background: rgba(255, 0, 0, 0.15);
      border: 1px solid var(--error);
    }
    
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 25px;
      font-size: 0.95em;
      box-shadow: 0 0 25px rgba(0, 170, 255, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    table::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--secondary), transparent);
      animation: scanline 8s linear infinite;
      z-index: 1;
    }
    
    th, td {
      border: 1px solid var(--primary);
      padding: 8px;
      text-align: center;
      position: relative;
    }
    
    th {
      background-color: rgba(0, 170, 255, 0.2);
      color: var(--secondary);
      font-weight: normal;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9em;
    }
    
    .slot-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 40px;
    }
    
    .slot-code {
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .slot-class {
      font-size: 0.85em;
      margin-bottom: 2px;
    }
    
    .slot-location {
      font-size: 0.75em;
      color: var(--secondary);
      opacity: 0.8;
    }
    
    .highlight {
      background-color: var(--highlight);
      border: 1px solid var(--success);
      color: #fff;
      font-weight: bold;
      position: relative;
      animation: highlightPulse 2s infinite alternate;
    }
    
    @keyframes highlightPulse {
      0% { box-shadow: inset 0 0 10px rgba(0, 255, 170, 0.3); }
      100% { box-shadow: inset 0 0 20px rgba(0, 255, 170, 0.5); }
    }
    
    .highlight::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        transparent 45%,
        rgba(0, 255, 255, 0.15) 50%,
        transparent 55%
      );
      animation: glimmer 3s infinite linear;
      pointer-events: none;
    }
    
    @keyframes glimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 200% 0; }
    }
    
    textarea {
      resize: vertical;
      min-height: 60px;
    }
  </style>
</head>
<body>
  <h1>Timetable Slot Manager</h1>
  
  <div class="control-panel">
    <div class="input-group">
      <label for="slotCode">SLOT CODES (use + or new line)</label>
      <textarea id="slotCode" placeholder="A21+A22+A23+B22+C14+D21&#10;B14+C11+C12+C13+F11+F12"></textarea>
    </div>
    
    <div class="input-group">
      <label for="className">CLASS</label>
      <input type="text" id="className" placeholder="Class Name" maxlength="30" />
    </div>
    
    <div class="input-group">
      <label for="faculty">FACULTY</label>
      <input type="text" id="faculty" placeholder="Faculty" maxlength="20" />
    </div>
    
    <div class="input-group">
      <label for="location">LOCATION</label>
      <input type="text" id="location" placeholder="Location" maxlength="8" />
    </div>
    
    <div class="actions">
      <button id="addBtn">ADD SLOT</button>
      <button id="resetBtn">RESET ALL</button>
    </div>
    
    <div class="input-group">
      <label for="removeSelect">REMOVE SLOT</label>
      <select id="removeSelect">
        <option value="">Select slot...</option>
      </select>
    </div>
    
    <button id="removeBtn">REMOVE</button>
    
    <div class="status" id="status"></div>
  </div>

  <h2>Timetable</h2>
  <table id="timetable">
    <thead>
      <tr>
        <th>Day</th>
        <th>08:30-10:00</th>
        <th>10:05-11:35</th>
        <th>11:40-13:10</th>
        <th>Lunch</th>
        <th>13:15-14:45</th>
        <th>14:50-16:20</th>
        <th>16:25-17:55</th>
        <th>18:00-19:30</th>
      </tr>
    </thead>
    <tbody>
      <!-- Timetable rows here (same as your original) -->
    </tbody>
  </table>

  <script>
    const slotDetails = {};
    const addBtn = document.getElementById("addBtn");
    const removeBtn = document.getElementById("removeBtn");
    const resetBtn = document.getElementById("resetBtn");
    const status = document.getElementById("status");
    const slotInput = document.getElementById("slotCode");
    const removeSelect = document.getElementById("removeSelect");
    const classNameInput = document.getElementById("className");
    const facultyInput = document.getElementById("faculty");
    const locationInput = document.getElementById("location");

    function showStatus(msg, type) {
      status.textContent = msg;
      status.className = `status ${type}`;
      setTimeout(() => (status.textContent = ""), 4000);
    }

    function getSlotInfo(code) {
      const cell = document.querySelector(`[data-slot="${code}"]`);
      if (!cell) return null;
      const day = cell.closest("tr").dataset.day;
      const time = document.querySelector(`#timetable thead tr th:nth-child(${cell.cellIndex + 1})`).textContent;
      return { cell, day, time };
    }

    function hasLunchConflict(codes) {
      const lunch1 = "11:40-13:10";
      const lunch2 = "13:15-14:45";
      const dayTimeMap = {};

      for (const entry of Object.values(slotDetails).flat()) {
        if (!dayTimeMap[entry.day]) dayTimeMap[entry.day] = new Set();
        dayTimeMap[entry.day].add(entry.time);
      }

      for (let code of codes) {
        const info = getSlotInfo(code);
        if (!info) continue;
        if (!dayTimeMap[info.day]) dayTimeMap[info.day] = new Set();
        dayTimeMap[info.day].add(info.time);
      }

      for (const times of Object.values(dayTimeMap)) {
        if (times.has(lunch1) && times.has(lunch2)) {
          return true;
        }
      }

      return false;
    }

    function updateSlotDisplay(cell, className, location) {
      const slotContent = cell.querySelector('.slot-content') || document.createElement('div');
      slotContent.className = 'slot-content';
      
      if (className || location) {
        slotContent.innerHTML = `
          <span class="slot-code">${cell.dataset.slot}</span>
          ${className ? `<span class="slot-class">${className}</span>` : ''}
          ${location ? `<span class="slot-location">${location}</span>` : ''}
        `;
      } else {
        slotContent.innerHTML = `<span class="slot-code">${cell.dataset.slot}</span>`;
      }
      
      if (!cell.querySelector('.slot-content')) {
        cell.innerHTML = '';
        cell.appendChild(slotContent);
      }
    }

    function updateDropdown() {
      removeSelect.innerHTML = `<option value="">Select slot to remove</option>`;
      Object.keys(slotDetails).forEach(code => {
        const opt = document.createElement("option");
        opt.value = code;
        opt.textContent = code;
        removeSelect.appendChild(opt);
      });
    }

    addBtn.addEventListener("click", () => {
      const input = slotInput.value.trim().toUpperCase();
      if (!input) return showStatus("Enter slot code(s)", "error");

      // Split by lines first, then by +
      const lines = input.split(/\n/).map(l => l.trim()).filter(l => l);
      
      for (let line of lines) {
        const codes = line.split("+").map(s => s.trim());
        const allValid = codes.every(code => /^[A-Z]\d{2}$/.test(code));
        if (!allValid) return showStatus(`Invalid slot code(s) in "${line}"`, "error");

        const className = classNameInput.value.trim();
        const faculty = facultyInput.value.trim();
        const location = locationInput.value.trim();

        const validationErrors = [];
        const details = [];

        for (let code of codes) {
          const info = getSlotInfo(code);
          if (!info) {
            validationErrors.push(`Slot ${code} not found`);
            continue;
          }
          if (Object.values(slotDetails).some(arr => arr.find(s => s.code === code))) {
            validationErrors.push(`Slot ${code} already booked`);
            continue;
          }

          info.code = code;
          info.className = className;
          info.faculty = faculty;
          info.location = location;
          details.push(info);
        }

        if (hasLunchConflict(details.map(d => d.code))) {
          validationErrors.push("Cannot book both 11:40-13:10 and 13:15-14:45 on same day");
        }

        if (validationErrors.length > 0) {
          return showStatus(`❌ ${validationErrors.join(", ")}`, "error");
        }

        for (const info of details) {
          info.cell.classList.add("highlight");
          updateSlotDisplay(info.cell, className, location);
        }

        slotDetails[line] = details;
      }

      updateDropdown();
      showStatus("✅ Slot(s) added successfully", "success");
      slotInput.value = classNameInput.value = facultyInput.value = locationInput.value = "";
    });

    removeBtn.addEventListener("click", () => {
      const selected = removeSelect.value;
      if (!selected || !slotDetails[selected]) return showStatus("Select a slot to remove", "error");

      slotDetails[selected].forEach(info => {
        info.cell.classList.remove("highlight");
        updateSlotDisplay(info.cell, "", "");
      });

      delete slotDetails[selected];
      updateDropdown();
      showStatus("✅ Slot removed", "success");
    });

    resetBtn.addEventListener("click", () => {
      Object.values(slotDetails).flat().forEach(info => {
        info.cell.classList.remove("highlight");
        updateSlotDisplay(info.cell, "", "");
      });
      Object.keys(slotDetails).forEach(k => delete slotDetails[k]);
      updateDropdown();
      showStatus("✅ All slots reset", "success");
    });

  </script>
</body>
</html>
